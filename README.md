# Dobot-Robotmatch-Lua
2024中国工程机器人大赛暨国际公开赛山东大学13队（项目：桌面机械臂11棋子分拣）

机械臂运动控制程序，使用Lua语言开发

[TOC]

## 工程结构

程序由两个文件构成：

- `src0.lua`为主程序，直接执行
- `global.lua`用于定义变量和子函数，对主程序可见

## 参数设置
加速度与加加速度提高至1.5倍左右，适当调整即可。

## 注意事项
每次**环境变更**必须更新的常量包括：

1. 下降高度`get_height`
2. 地理围栏（在函数`calculateParams`中）
3. 黑棋下降高度补偿（在函数`move`中）
4. 碰撞危险位置（在函数`performMovement`中）

可能需要更新的常量包括：

1. 关节J6安全区（在函数`performMovement`中）
2. 垂直下降运动加速度（`a_vertical`）

## 修订说明

### V1.0

基本实现所有功能，现场总线同步性丢失的问题仍未解决。

### V1.1

增加了危险位置撤步的功能，防止碰撞摄像头杆。

### V1.2

即使未接收数据，也会轮询请求数据，防止最后的点位被遗漏。

### V1.3

最终版，参数调整。规避了现场总线同步性丢失的问题。

具体参见[现场总线同步性丢失问题猜想](#现场总线同步性丢失问题)

## 现场总线同步性丢失问题

### 触发原因

**现场总线同步性丢失问题**（以下简称掉线问题）触发原因的猜想：

- 运动速度过快，而控制器计算与处理需要时间，以至于控制器响应与电机执行存在时间差，造成某一快速运动的节点出现此掉线问题。

- 机械臂内部存在故障（大概率为电缆）或零件松弛（大概率为端子），可能因接口部分损坏或信号线接触不良导致总线数据传输时断时续，导致掉线问题。

- 环境噪声较大，可能产生信号干扰，当出现强信号干扰时出现掉线问题，但概率较小。

### 解决方案

最终的解决方案：调整运动参数，降低了先前设置的速度、加速度、加加速度等，最终得以有效规避故障。

### 排查遗漏之处

排查遗漏之处：

1. 未检测终端电阻接入情况（E_Cat是否有终端电阻，还是只有RS485有这一说法，我院《运动控制系统》只讲了PROFIBUS，别的我都不会0.0）。

上面这条更进一步：工控机在此系统充当主站，机械臂控制器为从站，控制器无法控制电机，怀疑是此二者之间某线路导通不良，从这一角度上不必检测终端电阻。

2. 电源未检查，电源供电不稳可能导致电压波动，影响机械臂的正常运行。

工坊暂无合适设备。

### 遗憾之处

遗憾之处：

厂家工程师未能解决此问题，曾怀疑代码中存在某些奇妙之处诱发了这一故障，但我们并未发现，这一悬念就留于后人解决了。